#!/usr/bin/ruby

require_relative "../lib/churn.rb"
require_relative "../lib/churn_affected_line.rb"
require_relative "../lib/churn_standard.rb"

CHURN_OPTS = {format: '--json', compute: '--affected-lines'}
argv = ARGV - CHURN_OPTS.values
params = argv.reduce{ |a, b| a + " " + b} || ""
opt = CHURN_OPTS.delete_if{ |k, v| not ARGV.include? v}

begin
  case opt[:compute]
  when '--affected-lines'
    ChurnAffectedLine::root_directory = Dir.getwd
    puts ChurnAffectedLine::get_output opt.merge({git_params: params})
  else
    ChurnStandard::root_directory = Dir.getwd
    puts ChurnStandard::get_output opt.merge({git_params: params})
  end

rescue Exception => e
  puts e.message
end
